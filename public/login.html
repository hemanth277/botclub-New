<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Botclub | Authentication</title>
  <link rel="stylesheet" href="customer-auth.css">
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <!-- Import Parisienne font for logo -->
  <link href="https://fonts.googleapis.com/css2?family=Parisienne&display=swap" rel="stylesheet">
</head>

<body>
  <header>
    <a href="index.html" class="logo">Botclub</a>
    <nav>
      <a href="index.html">Home</a>
      <a href="dashboard.html" id="nav-dashboard" style="display: none;">Dashboard</a>
      <a href="admin.html" id="nav-admin" style="display: none;">Admin</a>
      <a href="login.html" id="nav-auth">Login</a>
    </nav>
  </header>

  <div class="container" style="max-width: 400px; width: 100%; margin: auto;">

    <!-- Entry Screen -->
    <div id="entry-screen" class="auth-card animate-fade"
      style="background: var(--bg-card); padding: 2.5rem; border-radius: var(--radius); border: 1px solid rgba(255,255,255,0.05); box-shadow: 0 20px 25px -5px rgba(0,0,0,0.5); text-align: center;">
      <h2 style="font-size: 2rem; margin-bottom: 1rem;">Welcome to<br>Botclub</h2>
      <p style="color: var(--text-muted); margin-bottom: 2rem;">Premium e-commerce experience</p>
      <button onclick="showRoleSelection()"
        style="width: 100%; background: var(--primary); color: white; padding: 1rem; border-radius: 8px; border: none; font-weight: 600; cursor: pointer; transition: var(--transition); font-size: 1.1rem;">Login</button>
    </div>

    <!-- Role Selection Screen -->
    <div id="role-selection" class="auth-card animate-fade"
      style="display: none; background: var(--bg-card); padding: 2.5rem; border-radius: var(--radius); border: 1px solid rgba(255,255,255,0.05); box-shadow: 0 20px 25px -5px rgba(0,0,0,0.5); text-align: center;">
      <h2 style="font-size: 1.75rem; margin-bottom: 2rem;">Select Logical Portal</h2>
      <button onclick="selectRole('customer')"
        style="width: 100%; background: var(--primary); color: white; padding: 1rem; border-radius: 8px; border: none; font-weight: 600; cursor: pointer; transition: var(--transition); margin-bottom: 1rem; font-size: 1.1rem;">Customer
        Login</button>
      <button onclick="selectRole('admin')"
        style="width: 100%; background: transparent; border: 2px solid var(--text-muted); color: var(--text-main); padding: 1rem; border-radius: 8px; font-weight: 600; cursor: pointer; transition: var(--transition); font-size: 1.1rem;">Admin
        Login</button>
    </div>

    <!-- Auth Form -->
    <div id="auth-container" class="auth-card animate-fade"
      style="background: var(--bg-card); padding: 2.5rem; border-radius: var(--radius); border: 1px solid rgba(255,255,255,0.05); box-shadow: 0 20px 25px -5px rgba(0,0,0,0.5); display: none;">
      <button onclick="resetRole()"
        style="background: none; border: none; color: var(--text-muted); cursor: pointer; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">‚Üê
        Back</button>
      <h2 id="auth-title" style="font-size: 2rem; margin-bottom: 0.5rem; text-align: center;">Welcome Back</h2>
      <p id="auth-subtitle" style="color: var(--text-muted); text-align: center; margin-bottom: 2rem;">Please sign in to
        your account</p>

      <form id="auth-form">
        <div id="username-group" style="margin-bottom: 1.5rem;">
          <label style="display: block; margin-bottom: 0.5rem; color: var(--text-muted);">Username</label>
          <input type="text" id="username" required
            style="width: 100%; background: var(--bg-dark); border: 1px solid rgba(255,255,255,0.1); padding: 0.75rem 1rem; border-radius: 8px; color: white;">
        </div>

        <div id="email-group" style="margin-bottom: 1.5rem; display: none;">
          <label style="display: block; margin-bottom: 0.5rem; color: var(--text-muted);">Email Address</label>
          <input type="email" id="email"
            style="width: 100%; background: var(--bg-dark); border: 1px solid rgba(255,255,255,0.1); padding: 0.75rem 1rem; border-radius: 8px; color: white;">
        </div>

        <div style="margin-bottom: 2rem;">
          <label style="display: block; margin-bottom: 0.5rem; color: var(--text-muted);">Password</label>
          <input type="password" id="password" required
            style="width: 100%; background: var(--bg-dark); border: 1px solid rgba(255,255,255,0.1); padding: 0.75rem 1rem; border-radius: 8px; color: white;">
        </div>

        <button type="submit"
          style="width: 100%; background: var(--primary); color: white; padding: 0.75rem; border-radius: 8px; border: none; font-weight: 600; cursor: pointer; transition: var(--transition);">Sign
          In</button>
      </form>

      <p id="toggle-container" style="text-align: center; margin-top: 1.5rem; color: var(--text-muted);">
        <span id="toggle-text">Don't have an account?</span>
        <a href="#" id="toggle-auth" style="color: var(--primary); text-decoration: none; font-weight: 600;">Sign Up</a>
      </p>
    </div>
  </div>

  </div>

  <script src="nav.js"></script>
  <script>
    let isLogin = true;
    let selectedRole = 'customer';

    const entryScreen = document.getElementById('entry-screen');
    const roleSelection = document.getElementById('role-selection');
    const authContainer = document.getElementById('auth-container');
    const form = document.getElementById('auth-form');
    const title = document.getElementById('auth-title');
    const subtitle = document.getElementById('auth-subtitle');
    const toggleBtn = document.getElementById('toggle-auth');
    const toggleText = document.getElementById('toggle-text');
    const emailGroup = document.getElementById('email-group');
    const toggleContainer = document.getElementById('toggle-container');

    function showRoleSelection() {
      entryScreen.style.display = 'none';
      roleSelection.style.display = 'block';
    }

    function selectRole(role) {
      selectedRole = role;
      roleSelection.style.display = 'none';
      authContainer.style.display = 'block';

      if (role === 'admin') {
        title.textContent = 'Admin Login';
        subtitle.textContent = 'Manage your store';
        toggleContainer.style.display = 'none'; // Admins can't self-register
        isLogin = true;
        emailGroup.style.display = 'none';
      } else {
        title.textContent = 'Welcome Back';
        subtitle.textContent = 'Please sign in to your account';
        toggleContainer.style.display = 'block';
        isLogin = true;
      }
    }

    function resetRole() {
      roleSelection.style.display = 'block';
      authContainer.style.display = 'none';
      document.getElementById('username').value = '';
      document.getElementById('password').value = '';
      document.getElementById('email').value = '';
    }

    toggleBtn.onclick = (e) => {
      e.preventDefault();
      isLogin = !isLogin;
      title.textContent = isLogin ? 'Welcome Back' : 'Create Account';
      subtitle.textContent = isLogin ? 'Please sign in to your account' : 'Join our premium community today';
      toggleText.textContent = isLogin ? "Don't have an account?" : "Already have an account?";
      toggleBtn.textContent = isLogin ? 'Sign Up' : 'Sign In';
      emailGroup.style.display = isLogin ? 'none' : 'block';
      form.querySelector('button').textContent = isLogin ? 'Sign In' : 'Create Account';
    };

    form.onsubmit = async (e) => {
      e.preventDefault();
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      const email = document.getElementById('email').value;

      const endpoint = isLogin ? '/api/auth/login' : '/api/auth/register';
      const body = isLogin ? { username, password } : { username, email, password };

      try {
        const res = await fetch(endpoint, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(body)
        });
        const data = await res.json();

        if (res.ok) {
          if (isLogin) {
            // Role verification
            if (selectedRole === 'admin' && data.user.role !== 'admin') {
              alert('Access Denied: You are not an admin');
              return;
            }

            localStorage.setItem('user', JSON.stringify(data.user));
            window.location.href = selectedRole === 'admin' ? 'admin.html' : 'index.html';
          } else {
            alert('Registration successful! Please login.');
            toggleBtn.click();
          }
        } else {
          alert(data.message);
        }
      } catch (err) {
        console.error(err);
        alert('Connection error: ' + err.message);
      }
    };
  </script>
</body>

</html>